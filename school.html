<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>School Portal - School Details</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
  body {
    margin: 0;
    font-family: 'Montserrat', Arial, sans-serif;
    background: linear-gradient(135deg, #e8f0fe, #98e6cf 80%);
    color: #233247;
  }
  header {
    background-color: #000;
    color: #fff;
    padding: 2.5rem 1rem;
    text-align: center;
    border-bottom-left-radius: 40px;
    border-bottom-right-radius: 40px;
  }
  header h1 {
    font-size: 2.4rem;
    letter-spacing: 0.04em;
    font-weight: 700;
    margin: 0;
  }
  .container {
    max-width: 900px;
    margin: 2rem auto 4rem;
    background: white;
    border-radius: 15px;
    padding: 2rem 3rem;
    box-shadow: 0 10px 30px rgb(56 239 125 / 0.35);
  }
  .photo-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.6rem;
  }
  .photo-gallery img {
    width: 150px;
    height: 120px;
    object-fit: cover;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 2px 8px #bafedeaa;
    transition: transform 0.25s ease;
  }
  .photo-gallery img:hover {
    transform: scale(1.05);
  }
  .contact-section, .info-section {
    margin-bottom: 1.3rem;
  }
  .social-links a {
    margin-right: 1rem;
    font-size: 1.7rem;
    color: #1d8fff;
    transition: color 0.22s;
  }
  .social-links a:hover {
    color: #38ef7d;
  }
  .btn {
    background-color: #38ef7d;
    color: #025e2d;
    font-weight: 700;
    padding: 0.6rem 1.2rem;
    border-radius: 24px;
    margin-right: 1rem;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(56,239,125,0.5);
    border: none;
    transition: background-color 0.24s;
  }
  .btn:hover {
    background-color: #147822;
    color: white;
  }
  h2 {
    font-weight: 700;
    margin-bottom: 0.7rem;
    font-size: 1.3rem;
  }
  .search-child-box {
    margin-top: 2rem;
    padding: 1.3rem;
    background: #f0f7f4;
    border-radius: 12px;
    box-shadow: 0 2px 10px #bafedeaa;
  }
  .search-child-box input {
    padding: 0.6rem 0.9rem;
    border-radius: 20px;
    border: 2px solid #1d8fff;
    width: 70%;
    font-size: 1.1rem;
    outline-offset: 0;
    transition: border-color 0.25s;
  }
  .search-child-box input:focus {
    border-color: #38ef7d;
    outline: none;
  }
  .search-child-box button {
    padding: 0.62rem 1.3rem;
    border-radius: 20px;
    font-weight: 700;
  }
  .notification-section {
    background: #f9fef9;
    border-radius: 12px;
    padding: 1rem 1.4rem;
    margin-bottom: 2rem;
    font-size: 1rem;
  }
  .notification-section p {
    margin-bottom: 0.4rem;
  }
  .notice {
    background: #fff3cd;
    border-left: 6px solid #ffecb5;
    padding: 0.9rem;
    margin-bottom: 1rem;
    border-radius: 8px;
  }
  footer {
    max-width: 900px;
    margin: 4rem auto 2rem;
    text-align: center;
    font-size: 0.94rem;
    color: #617d98;
  }
</style>
</head>
<body>

<header>
  <h1 id="schoolNameHeader">Loading School Info...</h1>
</header>

<div class="container">
  <section class="info-section">
    <h2>About the School</h2>
    <p><strong>Motto:</strong> <span id="schoolMotto"></span></p>
    <p><strong>Vision:</strong> <span id="schoolVision"></span></p>
    <p id="schoolDescription"></p>
    <div class="photo-gallery" id="photoGallery"></div>
  </section>

  <section class="contact-section">
    <h2>Contact Information</h2>
    <p><strong>Phone/Email:</strong> <span id="schoolContact"></span></p>
    <p><strong>Principal:</strong> <span id="schoolPrincipal"></span></p>
    <p><strong>Principal Contact:</strong> <span id="schoolPrincipalContact"></span></p>
    <p><strong>Location:</strong> <span id="schoolLocation"></span></p>
    <p><strong>Levels Offered:</strong> <span id="schoolLevels"></span></p>
    <p><strong>Type:</strong> <span id="schoolType"></span></p>
    <p><strong>Facilities:</strong> <span id="schoolFacilities"></span></p>
    <p><strong>Languages of Instruction:</strong> <span id="schoolLanguages"></span></p>
    <p><strong>Website:</strong> <a href="#" id="schoolWebsiteLink" target="_blank" rel="noopener noreferrer"></a></p>
    <div class="social-links" id="socialLinks"></div>
  </section>

  <section class="notification-section">
    <h2>School Notifications</h2>
    <div id="notificationsList">Loading notifications...</div>
  </section>

  <section>
    <button class="btn" id="adminLoginBtn">School Admin Login</button>
</section>

  </section>
    <a href="https://wa.me/254769883456" target="_blank" class="btn">Contact Portal Admin on WhatsApp</a>
    <p>Our services are free for schools! Contact us to register your school admin and start using our management systems.</p>
  </section>

  <section class="search-child-box">
    <h2>Find Your Childâ€™s Records</h2>
    <p>Enter child's admission number to search results and fee balances.</p>
    <input type="text" id="studentAdmissionInput" placeholder="Admission Number" autocomplete="off" />
    <button id="searchChildBtn" class="btn">Search</button>
    <div id="searchChildStatus"></div>
  </section>

  <section>
    <p><strong>Note to Parents:</strong> You can create free accounts on our portal to save your children from any school for quick access and monitoring.</p>
    <p><a href="login.html">Parent Login / Register</a></p>
  </section>
</div>

<footer>
  Kenya School Portal &copy; 2025
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, doc, getDoc, collection, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBnpne91aBQsRYefwHO5fcaGliJTo8jhMk",
    authDomain: "school-portal-233f5.firebaseapp.com",
    projectId: "school-portal-233f5",
    storageBucket: "school-portal-233f5.appspot.com",
    messagingSenderId: "314984934331",
    appId: "1:314984934331:web:92922fcc7a959e1fa0729e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Extract school id from URL
  const params = new URLSearchParams(window.location.search);
  const schoolId = params.get('id');

  // Cache references
  const header = document.getElementById('schoolNameHeader');
  const mottoEl = document.getElementById('schoolMotto');
  const visionEl = document.getElementById('schoolVision');
  const descriptionEl = document.getElementById('schoolDescription');
  const galleryEl = document.getElementById('photoGallery');
  const contactEl = document.getElementById('schoolContact');
  const principalEl = document.getElementById('schoolPrincipal');
  const principalContactEl = document.getElementById('schoolPrincipalContact');
  const locationEl = document.getElementById('schoolLocation');
  const levelsEl = document.getElementById('schoolLevels');
  const typeEl = document.getElementById('schoolType');
  const facilitiesEl = document.getElementById('schoolFacilities');
  const languagesEl = document.getElementById('schoolLanguages');
  const websiteLink = document.getElementById('schoolWebsiteLink');
  const socialLinksEl = document.getElementById('socialLinks');
  const notificationsList = document.getElementById('notificationsList');
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const searchChildBtn = document.getElementById('searchChildBtn');
  const studentAdmissionInput = document.getElementById('studentAdmissionInput');
  const searchChildStatus = document.getElementById('searchChildStatus');

  // Load school data
  async function loadSchool() {
    if (!schoolId) {
      header.textContent = 'School ID missing';
      return;
    }
    const docRef = doc(db, 'schools', schoolId);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) {
      header.textContent = 'School not found';
      return;
    }
    const data = docSnap.data();
    
    header.textContent = data.name || 'Unnamed School';
    mottoEl.textContent = data.motto || 'Not provided';
    visionEl.textContent = data.vision || 'Not provided';
    descriptionEl.textContent = data.description || 'No description available.';
    contactEl.textContent = data.contact || 'N/A';
    principalEl.textContent = data.principal || 'N/A';
    principalContactEl.textContent = data.principalContact || 'N/A';
    locationEl.textContent = `${data.county || ''}${data.location ? ', ' + data.location : ''}`;
    levelsEl.textContent = (data.levels || []).join(', ');
    typeEl.textContent = data.type || 'N/A';
    facilitiesEl.textContent = data.facilities || 'N/A';
    languagesEl.textContent = data.languages || 'N/A';
    if(data.website){
      websiteLink.textContent = data.website;
      websiteLink.href = data.website;
    } else {
      websiteLink.style.display = 'none';
    }

    // Photos gallery
    galleryEl.innerHTML = '';
    (data.photos || []).forEach(url => {
      const img = document.createElement('img');
      img.src = url;
      img.alt = data.name + ' photo';
      img.onclick = () => window.open(url, '_blank');
      galleryEl.appendChild(img);
    });

    // Social media links
    socialLinksEl.innerHTML = '';
    if(data.socialLinks) {
      const soc = data.socialLinks;
      if(soc.facebook) socialLinksEl.appendChild(createSocialIconLink('facebook', soc.facebook));
      if(soc.twitter) socialLinksEl.appendChild(createSocialIconLink('twitter', soc.twitter));
      if(soc.instagram) socialLinksEl.appendChild(createSocialIconLink('instagram', soc.instagram));
    }
  }

  // Social media icons (fontawesome SVG inline)
  function createSocialIconLink(type, url) {
    let svg = '';
    switch(type) {
      case 'facebook': svg = `<svg ...Facebook SVG Icon...></svg>`; break;
      case 'twitter': svg = `<svg ...Twitter SVG Icon...></svg>`; break;
      case 'instagram': svg = `<svg ...Instagram SVG Icon...></svg>`; break;
    }
    const a = document.createElement('a');
    a.href = url;
    a.target = '_blank';
    a.rel = 'noopener';
    a.title = type[0].toUpperCase() + type.slice(1);
    a.innerHTML = svg;
    return a;
  }

  // Load notifications realtime
  function loadNotifications() {
    const q = query(collection(db, 'notifications'), where('schoolId', '==', schoolId), orderBy('createdAt', 'desc'));
    onSnapshot(q, (snapshot) => {
      notificationsList.innerHTML = '';
      if (snapshot.empty) {
        notificationsList.innerHTML = '<p>No notifications</p>';
        return;
      }
      snapshot.forEach(doc => {
        const n = doc.data();
        const p = document.createElement('p');
        p.innerHTML = `<strong>${n.title || 'Notification'}:</strong> ${n.message || ''}`;
        notificationsList.appendChild(p);
      });
    });
  }

  // Admin Login button click
  adminLoginBtn.onclick = () => {
    window.location.href = 'login.html'; // or admin dashboard login if separate
  }

  // Child admission search (for parents)
  searchChildBtn.onclick = async () => {
    searchChildStatus.textContent = '';
    const admission = studentAdmissionInput.value.trim();
    if (!admission) {
      searchChildStatus.textContent = 'Enter admission number';
      return;
    }
    try {
      // Query students collection by admission
      const studentsCol = collection(db, 'students');
      const q = query(studentsCol, where('admission', '==', admission), where('schoolId', '==', schoolId));
      const snapshot = await getDocs(q);
      if (snapshot.empty) {
        searchChildStatus.textContent = 'No records found for that admission number.';
        return;
      }
      snapshot.forEach(doc => {
        const st = doc.data();
        window.location.href = `student.html?id=${doc.id}&schoolId=${schoolId}&admission=${admission}`;
      });
    } catch(err) {
      searchChildStatus.textContent = 'Error fetching student info: ' + err.message;
    }
  }

  loadSchool();
  loadNotifications();

</script>

</body>
      </html>
  
